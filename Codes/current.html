<!DOCTYPE html>
<html>
<head>
<script>
setInterval("getCurrent(1);getVoltage(2);getFrequency(3);getPhase(4)",500);
           function getCurrent(int) 
				{
				 if (window.XMLHttpRequest)
				 {
					// code for IE7+, Firefox, Chrome, Opera, Safari
					var xmlhttp1=new XMLHttpRequest();
				  } else 
				  {  // code for IE6, IE5
					var xmlhttp1=new ActiveXObject("Microsoft.XMLHTTP");
				  }
				  var store1= xmlhttp1.onreadystatechange=function()
				  {
					if (xmlhttp1.readyState==4 && xmlhttp1.status==200)
					{
			var store = xmlhttp1.responseText;
					 var UI=document.getElementById("curread");
					   UI.innerHTML =store;
					}
				  }
				  xmlhttp1.open("GET","refresh.php?q="+int,true);
				  xmlhttp1.send();
				}
				
				
		 function getVoltage(int) 
				{
				 if (window.XMLHttpRequest) {
					// code for IE7+, Firefox, Chrome, Opera, Safari
					var xmlhttp2=new XMLHttpRequest();
				  } else {  // code for IE6, IE5
					var xmlhttp2=new ActiveXObject("Microsoft.XMLHTTP");
				  }
				  xmlhttp2.onreadystatechange=function() {
					if (xmlhttp2.readyState==4 && xmlhttp2.status==200) {
					 var store2 = xmlhttp2.responseText;
					 var UI=document.getElementById("volread");
					 UI.innerHTML=store2;
					}
				  }
				  xmlhttp2.open("GET","refresh.php?q="+int,true);
				  xmlhttp2.send();
				}

function getPhase(int) 
				{
				 if (window.XMLHttpRequest) {
					// code for IE7+, Firefox, Chrome, Opera, Safari
					var xmlhttp3=new XMLHttpRequest();
				  } else {  // code for IE6, IE5
					var xmlhttp3=new ActiveXObject("Microsoft.XMLHTTP");
				  }
				  xmlhttp3.onreadystatechange=function() {
					if (xmlhttp3.readyState==4 && xmlhttp3.status==200) {
					 var store3 = xmlhttp3.responseText;
					 var UI=document.getElementById("pharead");
					    UI.innerHTML=store3;
				
					}
				  }
				  xmlhttp3.open("GET","refresh.php?q="+int,true);
				  xmlhttp3.send();
				}

 
  function getFrequency(int) 
				{
				 if (window.XMLHttpRequest) {
					// code for IE7+, Firefox, Chrome, Opera, Safari
					var xmlhttp4=new XMLHttpRequest();
				  } else {  // code for IE6, IE5
					var xmlhttp4=new ActiveXObject("Microsoft.XMLHTTP");
				  }
				  xmlhttp4.onreadystatechange=function() 
				  {
					if (xmlhttp4.readyState==4 && xmlhttp4.status==200) {
					 var store4 = xmlhttp4.responseText;
							 var UI=document.getElementById("freread");
					 UI.innerHTML = store4;
					
					 }
				
					}
				  
				  xmlhttp4.open("GET","refresh.php?q="+int,true);
				  xmlhttp4.send();
				}
</script>
 <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);
	  /*$.getJSON('action_page.php', function(json) {
	  alert(JSON.stringify(json));
			//var dataTable = new google.visualization.DataTable(json);
		});*/
	  var dataTable=null;
	  var chart=null;
	  var options;
	  var oldTime=null;
      function drawChart() {
	  
	  $.getJSON('action_page.php', function(json) {
	  //alert(JSON.stringify(json));
		    dataTable = new google.visualization.DataTable();
			dataTable.addColumn('datetime',   'time');
			 dataTable.addColumn('number', 'current');
			 oldTime=json[0].time;
			 dataTable.addRow([new Date(json[0].time), parseInt(json[0].current)]);
			 //dataTable.addRow([new Date(json[0].time), parseInt(json[0].current)]);
		options = {
          title: 'Sensor',
          curveType: 'function',
		  pointSize: 3,
		   vAxis: {minValue:0, maxValue:10},
		  pointShape: 'circle',	
          legend: { position: 'top' }
        };

        chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

        chart.draw(dataTable, options);
		});
		var app=200;
		setInterval(function(){
			$.getJSON('action_page.php', function(json) {
			if(!(oldTime===json[0].time))
				dataTable.addRow([new Date(json[0].time), parseInt(json[0].current)]);	
			console.log(dataTable.getNumberOfRows());
		if (dataTable.getNumberOfRows()>100)
				{
					dataTable.removeRow(0);		
				}
			});
			chart.draw(dataTable, options);
			console.log(app); 
			app=app+200;
		},500)
      }
    </script>
</script>
<style>

h1
{ 
  border: 100%;
  background-color : #50ff50;
  text-align: center;
  color: white;
  font-size: 30px;
  font-family: corbel;
  
}

ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
    overflow: hidden;
    background-color: #333;
}

li {
    float: left;
}

li a {
    display: block;
    color: white;
    text-align: center;
    padding: 14px 16px;
    text-decoration: none;
	font-family: impact;
}

li a:hover {
    background-color: #50ff50;
	color: black;
}
li a:active
{ 
 background-color: #50ff50;
 color: black;
}
#back
{ 
  height: 510px;
  width : 100%;
  background-color: white;
  
}
img
{
 height: 510px;
  width : 100%;
}
#about
{
 height: 300px;
  width : 100%;
  background-color: black;
}
#graph
{
 font-family:impact;
 color:white;
 margin:50px;
 height:300px;
 width:50%;
}
#maindiv
{ 
 background-color:#333;
 margin-top:-33px;
 padding-bottom:0px;
}
</style>
</head>
<body> 
<h1>
    <strong>GREEN HOUSE POWER MONITORING</strong>
</h1>
<ul>
  <li><a class="active" href="change.html">Home</a></li> 
  <li><a href="current.html">Current Status</a></li>
  <li><a href="past.html">Past 30 Days</a></li>
 <span style = "position:absolute;right:5px"> <li><a id="power" href="test.html">POWER</a></li><span>
</ul>
<div id="maindiv" style="height:100%" >
 <div id="graph">
 <p><br>
  PHASE
 </p>
  <img src="chart1.png" alt="mockdata" style="height:300px;width:684px">
</div>

 <div id="graph">
 <p><br>
  FREQUENCY
 </p>
  <img src="chart1.png" alt="mockdata" style="height:300px;width:684px">
</div>
 <div id="graph">
 <p><br>
  VOLTAGE
 </p>
  <img src="chart1.png" alt="mockdata" style="height:300px;width:684px">
  </div>
 <div id='graph'>
  <p><br>
  CURRENT
   </p>
   <div id="curve_chart"/>
   </div>
</div>

<div>
<h2 style="padding:50px;text-family:corbel;color:white;background-color:red">REAL TIME READINGS</h2> 
<p id="curread" style="text-family:corbel;color=#fff"></p>
<p id="volread" style="text-family:corbel;color=#FFFFFF"></p>
<p id="freread" style="text-family:corbel;color=white"></p>
<p id="pharead" style="text-family:corbel;color=#ffffff"></p>
</div>
</div>



</body>
</html>
